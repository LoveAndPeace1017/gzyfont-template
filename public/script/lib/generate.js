!function(){function t(e){if("object"==typeof(this.str=e))this[0]=e,this.length=1;else if(-1<e.indexOf("<"))this[0]=document.createElement(e.replace(/[<>]/g,"")),this.length=1;else for(var t=document.querySelectorAll(e),n=this.length=0;n<t.length;n++)this[n]=t[n],this.length++;return this}t.prototype={attr:function(e){if("object"!=typeof e)return this[0].getAttribute(e);for(var t=0;t<this.length;t++)for(var n=Object.keys(e),r=0;r<n.length;r++)this[t].setAttribute(n[r],e[n[r]]);return this},html:function(e){if("string"!=typeof e)return this[0].innerHTML;for(var t=0;t<this.length;t++)this[t].innerHTML=e;return this},appendTo:function(e){e[0].appendChild(this[0])},insertBefore:function(e){return e[0].parentNode.insertBefore(this[0],e[0]),this},find:function(e){return m(this.str+" "+e)},parent:function(e){return m(this[0].parentNode)},empty:function(){this.html("")},width:function(){return this.attr("width")},height:function(){return this.attr("height")},remove:function(){this[0].remove()}};var m=function(e){return new t(e)};function e(e){var t,n,r,o=e.exportElement,i=e.exportFileName,a=e.StringStyle?e.StringStyle:"",l=e.fileParams,s=m("#html-docx-config").html(),f=function(){var e=m("#page-header");m("#page-header").attr({data:e.html()}).html("");var t="";m("#first-page").length&&(t="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head></head><body>"+m("#first-page").html().replace(/\s{2,}/g,"")+'<br clear=all style="page-break-before:always" mce_style="page-break-before:always"></body></html>',m("#first-page").html(""));var n=m("#page-content");m("<span>").html('<br clear=all style="page-break-before:always" mce_style="page-break-before:always">').insertBefore(m(".change-line"));var r=m("#page-footer");return{header:{text:e.attr("data")||"",align:e.attr("textAlign")||"right"},footer:!!r.length,content:n.length,firstPage:t,titlePg:m("#first-page").length&&"true"===m("#first-page").attr("titlePg")}}(),c="#temporaryExportElement";m("<div>").attr({id:"temporaryExportElement"}).html(m(o).html()).appendTo(m("body")),function(e,t){for(var n=m(e).find("canvas"),r=m(t).find("canvas"),o=0;o<n.length;o++){var i=m(r[o]).parent().parent(),a=n[o].toDataURL("image/jpg");m(i).empty(),m("<img>").attr({src:a,width:m(n[o]).width(),height:m(n[o]).height()}).appendTo(i)}}(o,c),t=document.querySelectorAll("img"),n=document.createElement("canvas"),r=n.getContext("2d"),[].forEach.call(t,function(e){(e=new Image).setAttribute("crossOrigin","anonymous"),r.clearRect(0,0,n.width,n.height),n.width=e.width,n.height=e.height,r.drawImage(e,0,0);var t=n.toDataURL();e.setAttribute("src",t)}),n.remove();var u=l||{},d=["<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head></head><style>"+(a?a.replace(/(\s{2,}|\n)/g,""):"")+"</style><body>"+m(c).html().replace(/\s{2,}/g,"")+"</body></html>",f.firstPage],h=htmlDocx.asBlob(d,{margins:u.margins,config:f});m("#temporaryExportElement").remove(),g(h,i),f.firstPage&&m("#html-docx-config").html(s)}var g=g||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(g){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var p=g.document,w=function(){return g.URL||g.webkitURL||g},y=p.createElementNS("http://www.w3.org/1999/xhtml","a"),v=!g.externalHost&&"download"in y,b=g.webkitRequestFileSystem,E=g.requestFileSystem||b||g.mozRequestFileSystem,x="application/octet-stream",R=0,S=[],e=function(){for(var e=S.length;e--;){var t=S[e];"string"==typeof t?w().revokeObjectURL(t):t.remove()}S.length=0},O=function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){!function(e){(g.setImmediate||g.setTimeout)(function(){throw e},0)}(e)}}},n=function(r,n){function e(){var e=w().createObjectURL(r);return S.push(e),e}function t(){O(u,"writestart progress write writeend".split(" "))}function o(){!h&&a||(a=e()),l?l.location.href=a:window.open(a,"_blank"),u.readyState=u.DONE,t()}function i(e){return function(){if(u.readyState!==u.DONE)return e.apply(this,arguments)}}var a,l,s,f,c,u=this,d=r.type,h=!1,m={create:!0,exclusive:!1};if(u.readyState=u.INIT,n=n||"download",v)return a=e(),y.href=a,y.download=n,f=y,(c=p.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,g,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(c),u.readyState=u.DONE,void t();g.chrome&&d&&d!==x&&(s=r.slice||r.webkitSlice,r=s.call(r,0,r.size,x),h=!0),b&&"download"!==n&&(n+=".download"),d!==x&&!b||(l=g),E?(R+=r.size,E(g.TEMPORARY,R,i(function(e){e.root.getDirectory("saved",m,i(function(e){function t(){e.getFile(n,m,i(function(n){n.createWriter(i(function(t){t.onwriteend=function(e){l.location.href=n.toURL(),S.push(n),u.readyState=u.DONE,O(u,"writeend",e)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&o()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=u["on"+e]}),t.write(r),u.abort=function(){t.abort(),u.readyState=u.DONE},u.readyState=u.WRITING}),o)}),o)}e.getFile(n,{create:!1},i(function(e){e.remove(),t()}),i(function(e){(e.code===e.NOT_FOUND_ERR?t:o)()}))}),o)}),o)):o()},t=n.prototype,r=function(e,t){return new n(e,t)};return t.abort=function(){this.readyState=this.DONE,O(this,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,g.addEventListener("unload",e,!1),r.unload=function(){e(),g.removeEventListener("unload",e,!1)},r}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=g:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return g}),"undefined"!=typeof module&&null!==module?module.exports=e:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return e}):"undefined"!=typeof window&&(window.HtmlToDocx=e)}();